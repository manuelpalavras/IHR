<!DOCTYPE html>
<html lang="en">
<head onload="getLocation()">
    <script src="lib/leaflet/leaflet.js"></script>
    <link rel="stylesheet" type="text/css" href="lib/leaflet/leaflet.css"/>
    <link rel="stylesheet" href="lib/bootstrap/bootstrap.css">
    <script src="lib/bootstrap/bootstrap.js"></script>
    <script src="lib/jquery/jquery-3.3.1.js"></script>
    <script src="https://api.mqcdn.com/sdk/mapquest-js/v1.3.2/mapquest.js"></script>
    <link type="text/css" rel="stylesheet" href="https://api.mqcdn.com/sdk/mapquest-js/v1.3.2/mapquest.css"/>

    <meta charset="UTF-8">


    <title>Interactive Historical Routes</title>
</head>
<body onload="initmap()">
<header>
    <div id="nav"></div>
</header>
<div class="container-fluid" id="content">
    <div class="row">
        <div class="col-sm-2" id="PoI"></div>
        <div id="map" class="col-sm-10"></div>
    </div>
</div>

<script>
    $("#nav").load("./partials/nav.html");
    let id = `{{id}}`;
</script>
<script src="js/mapPointsRender.js"></script>
<script rel="script" src="./js/global.js"></script>
<script type="text/javascript">


    function initmap() {
        $.get('/information/getJSONFile/locationInfo.json', (coords) => {
            let center = JSON.parse(coords);
            L.mapquest.key = 'DaaGkPe6Uv6Zs2PmYaGpXLGpGDPBr1w9'
            var map = L.mapquest.map('map', {
                center: [center.Latitude, center.Longitude],
                layers: L.mapquest.tileLayer('map'),
                zoom: 60
            });
            map.addControl(L.mapquest.control());

            $.get(`/route/${id}`, (rota) => {
                console.log(rota);
                let waypointL = [];
                for (let i = 0; i < rota.PoI.length-1; i++) {
                    waypointL.push(rota.PoI[i].coordenadas.coordinates)
                }
                L.mapquest.directions().route({
                    start: [center.Latitude, center.Longitude],
                    end: `${rota.PoI[rota.PoI.length-1].coordenadas.coordinates}`,
                    waypoints: waypointL,

                    options: {
                        routeType: 'pedestrian'
                    }
                })
            })
        })
    }
</script>


<link rel="stylesheet" type="text/css" href="./stylesheets/mapPage.css">

</body>
</html>